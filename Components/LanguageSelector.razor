@rendermode InteractiveServer
@using VikashEngineeringWorksShop.Services
@inject LanguageService LanguageService
@implements IDisposable

<div class="relative">
    <button @onclick="ToggleDropdown" 
            @onclick:stopPropagation="true"
            class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-white transition-colors text-sm font-semibold">
        <i class="fa-solid fa-globe"></i>
        <span>@(LanguageService.IsEnglish ? "English" : "à¤¹à¤¿à¤‚à¤¦à¥€")</span>
        <i class="fa-solid fa-chevron-down text-xs transition-transform @(showDropdown ? "rotate-180" : "")"></i>
    </button>

    @if (showDropdown)
    {
        <!-- Backdrop to close dropdown when clicking outside -->
        <div class="fixed inset-0 z-40" @onclick="CloseDropdown"></div>
        
        <!-- Dropdown Menu -->
        <div class="absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-xl border border-gray-200 z-50 overflow-hidden" @onclick:stopPropagation="true">
            <button @onclick="@(() => ChangeLanguage("en"))" 
                    class="w-full text-left px-4 py-2 hover:bg-orange-50 transition-colors flex items-center gap-2 rounded-t-lg @(LanguageService.IsEnglish ? "bg-orange-50 text-orange-600 font-semibold" : "text-gray-700")">
                @* <span class="text-lg">ðŸ‡ºðŸ‡¸</span> *@
                <span>Eng</span>
                @if (LanguageService.IsEnglish)
                {
                    <i class="fa-solid fa-check ml-auto text-orange-600"></i>
                }
            </button>
            <button @onclick="@(() => ChangeLanguage("hi"))" 
                    class="w-full text-left px-4 py-2 hover:bg-orange-50 transition-colors flex items-center gap-2 rounded-b-lg @(LanguageService.IsHindi ? "bg-orange-50 text-orange-600 font-semibold" : "text-gray-700")">
                @* <span class="text-lg">ðŸ‡®ðŸ‡³</span> *@
                <span>à¤¹à¤¿à¤‚à¤¦à¥€</span>
                @if (LanguageService.IsHindi)
                {
                    <i class="fa-solid fa-check ml-auto text-orange-600"></i>
                }
            </button>
        </div>
    }
</div>

@code {
    private bool showDropdown = false;

    protected override void OnInitialized()
    {
        LanguageService.OnLanguageChanged += StateHasChanged;
    }

    private void ToggleDropdown()
    {
        showDropdown = !showDropdown;
    }

    private void CloseDropdown()
    {
        showDropdown = false;
    }

    private void ChangeLanguage(string lang)
    {
        LanguageService.SetLanguage(lang);
        showDropdown = false;
    }

    public void Dispose()
    {
        LanguageService.OnLanguageChanged -= StateHasChanged;
    }
}

